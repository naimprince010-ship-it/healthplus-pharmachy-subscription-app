generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentMethod {
  COD
  ONLINE
}

enum BannerLocation {
  HOME_HERO
  HOME_MID
  CATEGORY_TOP
}

enum ProductType {
  MEDICINE
  GENERAL
}

enum PageGroup {
  QUICK_LINKS
  SUPPORT
  NONE
}

// AI Import Wizard enums
enum AiImportJobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum AiProductDraftStatus {
  PENDING_REVIEW
  APPROVED
  REJECTED
  AI_ERROR
  MANUALLY_EDITED
}

// Phase 3: Image processing status for AiImportJob
enum AiImageJobStatus {
  NONE        // No images uploaded yet
  PENDING     // ZIP uploaded, not yet processed
  PROCESSING  // Currently processing images
  COMPLETED   // All images processed
  FAILED      // Image processing failed
}

// Phase 3: Image status for individual AiProductDraft
enum AiImageDraftStatus {
  UNMATCHED   // No image matched to this draft
  MATCHED     // Image matched but not yet processed
  PROCESSED   // Image processed (watermarked, resized, stored)
  MISSING     // Image was expected but not found in ZIP
  MANUAL      // Image manually uploaded by admin
}

model User {
  id            String           @id @default(cuid())
  name          String
  email         String?          @unique
  phone         String           @unique
  password      String
  role          Role             @default(USER)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  addresses     Address[]
  prescriptions Prescription[]
  orders        Order[]
  memberships   UserMembership[]
  subscriptions Subscription[]
  wishlistItems WishlistItem[]
}

model Address {
  id           String   @id @default(cuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  fullName     String
  phone        String
  addressLine1 String
  addressLine2 String?
  city         String
  zoneId       String
  zone         Zone     @relation(fields: [zoneId], references: [id])
  isDefault    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  orders       Order[]
}

model Zone {
  id             String         @id @default(cuid())
  name           String         @unique
  description    String? // List of areas covered
  deliveryCharge Float // Deprecated: use deliveryFee instead
  deliveryFee    Int? // Delivery fee in BDT
  deliveryDays   String
  isActive       Boolean        @default(true)
  sortOrder      Int            @default(0)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  addresses      Address[]
  orders         Order[]
  subscriptions  Subscription[]
}

model Category {
  id                 String        @id @default(cuid())
  name               String        @unique
  slug               String        @unique
  description        String?
  imageUrl           String?
  parentCategoryId   String?
  parentCategory     Category?     @relation("CategoryToSubCategory", fields: [parentCategoryId], references: [id], onDelete: SetNull)
  subCategories      Category[]    @relation("CategoryToSubCategory")
  isActive           Boolean       @default(true)
  isMedicineCategory Boolean       @default(false) // Auto-sets product.type when creating/updating products
  discountPercentage Float?        // Category-wide discount percentage (0-100)
  sortOrder          Int           @default(0)
  showInSidebar      Boolean       @default(false)
  sidebarOrder       Int           @default(0)
  sidebarIconUrl     String?
  sidebarLinkUrl     String?       // Custom link URL for sidebar (e.g., /sections/women-s-choice)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  medicines          Medicine[]
  products           Product[]
  homeSections       HomeSection[]
  // Phase 2: AI Import draft relations
  aiDraftsAsCategory    AiProductDraft[] // Drafts where this is the matched category
  aiDraftsAsSubcategory AiProductDraft[] @relation("SubcategoryDrafts") // Drafts where this is the matched subcategory
}

model Product {
  id          String      @id @default(cuid())
  type        ProductType
  name        String
  slug        String      @unique
  description String?

  // Media
  imageUrl  String?
  imagePath String? // Storage path for deletion

  // Pricing
  mrp               Float? // Maximum Retail Price
  sellingPrice      Float // Actual selling price
  purchasePrice     Float? // Cost price (what we pay to buy)
  discountPercentage Float? // Discount percentage (0-100)

  // Stock
  stockQuantity Int     @default(0)
  minStockAlert Int? // Low stock alert threshold
  inStock       Boolean @default(true)

  // Flash Sale Fields
  isFlashSale      Boolean   @default(false)
  flashSalePrice   Float?
  flashSaleStart   DateTime?
  flashSaleEnd     DateTime?

  // General Product Fields
  brandName    String? // Brand name (optional for medicines, common for general products)
  sizeLabel    String? // e.g., "50ml", "100g", "10 pcs", "1 device"
  unit         String  @default("pcs") // ml / g / pcs / pack / kit
  variantLabel String? // e.g., "Aloe Vera", "Lemon", "Red", "XL"
  keyFeatures  String? // Short text / bullet style features
  specSummary  String? // For devices ‚Äì simple text field for main specs

  // SEO Fields
  seoTitle       String?
  seoDescription String?
  seoKeywords    String?
  canonicalUrl   String?
  isFeatured     Boolean @default(false)

  // Search & Ranking
  popularityScore Int @default(0) // Derived from order count, used for search ranking

  // Membership discount override
  excludeFromMembershipDiscount Boolean @default(false)

  // Relations & Status
  categoryId     String
  category       Category      @relation(fields: [categoryId], references: [id])
  manufacturerId String?
  manufacturer   Manufacturer? @relation(fields: [manufacturerId], references: [id], onDelete: SetNull)
  isActive       Boolean       @default(true)
  deletedAt      DateTime?     // Soft delete timestamp

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  medicine        Medicine? // 1:1 relation for medicine-specific fields
  variants        ProductVariant[]
  orderItems      OrderItem[]
  cartSuggestions CartSuggestion[]
  wishlistItems   WishlistItem[]
}

model ProductVariant {
  id            String   @id @default(cuid())
  productId     String
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  variantName   String // e.g., "10's Strip", "250's pack", "50ml"
  unitLabel     String? // e.g., "/10's Strip", "/50ml", "/140 gm Tube" - shown after price
  sizeLabel     String? // e.g., "50ml", "100g"
  sku           String? // SKU / Barcode
  mrp           Float? // Variant-specific MRP
  sellingPrice  Float // Variant-specific selling price
  discountPercentage Float? // Variant-specific discount percentage (0-100)
  stockQuantity Int      @default(0)
  inStock       Boolean  @default(true)
  isDefault     Boolean  @default(false) // Mark as default variant for this product
  isActive      Boolean  @default(true)
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([productId, variantName])
}

model Medicine {
  id   String @id @default(cuid())
  name String
  slug String @unique

  // Product system integration (optional during Phase 1, will be populated during migration)
  productId String?  @unique
  product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)

  // Medicine-specific fields
  genericName  String?
  brandName    String?
  manufacturer String // Required manufacturer field
  dosageForm   String? // e.g., Tablet, Capsule, Syrup, Injection
  packSize     String? // e.g., "1 strip x 10 tablets"
  description  String?
  strength     String?
  unit         String  @default("pcs")

  // Pricing (new fields)
  mrp                Float? // Maximum Retail Price
  sellingPrice       Float // Actual selling price
  purchasePrice      Float? // Cost price (what we pay to buy)
  discountPercentage Float? // Discount percentage (0-100)
  price              Float // Deprecated: use sellingPrice instead
  discountPrice      Float? // Deprecated: use mrp/sellingPrice instead
  unitPrice          Float? // Price per tablet/capsule
  stripPrice         Float? // Price per strip
  tabletsPerStrip    Int? // Number of tablets per strip

  // Stock
  stockQuantity Int     @default(0)
  minStockAlert Int? // Low stock alert threshold
  inStock       Boolean @default(true)

  // SEO Fields
  seoTitle       String?
  seoDescription String?
  seoKeywords    String?
  canonicalUrl   String?
  isFeatured     Boolean @default(false)

  // Media
  imageUrl  String?
  imagePath String? // Storage path for deletion

  // Additional Details
  uses                String? // Common uses
  sideEffects         String? // Side effects
  contraindications   String? // Contraindications
  storageInstructions String? // Storage instructions
  expiryDate          DateTime? // Expiry date

  // Relations & Status
  categoryId           String
  category             Category  @relation(fields: [categoryId], references: [id])
  requiresPrescription Boolean   @default(false)
  isActive             Boolean   @default(true)
  deletedAt            DateTime? // Soft delete timestamp

  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  orderItems        OrderItem[]
  prescriptionItems PrescriptionItem[]
}

model Prescription {
  id        String             @id @default(cuid())
  userId    String
  user      User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String // Customer full name
  phone     String // Normalized phone number
  zoneId    String? // Delivery zone
  fileUrl   String // Prescription file URL
  fileType  String? // File MIME type
  status    String             @default("NEW") // NEW, REVIEWING, QUOTED, ORDERED, COMPLETED, CANCELLED
  notes     String? // Admin internal notes
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  items     PrescriptionItem[] // Prescription items parsed by admin
  order     Order? // Linked order if converted
}

model PrescriptionItem {
  id                   String       @id @default(cuid())
  prescriptionId       String
  prescription         Prescription @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)
  medicineId           String? // Optional: mapped to actual Medicine
  medicine             Medicine?    @relation(fields: [medicineId], references: [id], onDelete: SetNull)
  medicineNameSnapshot String? // Snapshot of medicine name at time of selection (for historical accuracy)
  genericName          String // Generic name from prescription
  strength             String? // e.g., "500mg"
  quantity             Int // Quantity prescribed
  note                 String? // Additional notes
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt
}

model Order {
  id                       String        @id @default(cuid())
  orderNumber              String        @unique
  userId                   String
  user                     User          @relation(fields: [userId], references: [id])
  addressId                String
  address                  Address       @relation(fields: [addressId], references: [id])
  zoneId                   String // Required: delivery zone for this order
  zone                     Zone          @relation(fields: [zoneId], references: [id])
  prescriptionId           String?       @unique // Optional: linked prescription
  prescription             Prescription? @relation(fields: [prescriptionId], references: [id], onDelete: SetNull)
  status                   OrderStatus   @default(PENDING)
  subtotal                 Float
  discount                 Float         @default(0)
  membershipDiscountAmount Float? // Membership discount applied
  membershipPlanName       String? // Membership plan name at time of order
  deliveryCharge           Float
  total                    Float
  paymentMethod            PaymentMethod @default(COD)
  paymentStatus            String        @default("PENDING")
  notes                    String?
  createdAt                DateTime      @default(now())
  updatedAt                DateTime      @updatedAt
  items                    OrderItem[]
}

model OrderItem {
  id      String @id @default(cuid())
  orderId String
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  // Product reference (new, will be used after migration in Phase 2)
  productId String?
  product   Product? @relation(fields: [productId], references: [id])

  // Medicine reference (legacy, keep for backward compatibility during Phase 1)
  medicineId String?
  medicine   Medicine? @relation(fields: [medicineId], references: [id])

  // Snapshot fields for historical accuracy (will be populated in Phase 2)
  productName String? // Product name at time of order
  productType String? // MEDICINE or GENERAL

  quantity  Int
  price     Float
  discount  Float    @default(0)
  total     Float
  createdAt DateTime @default(now())
}

model MembershipPlan {
  id              String           @id @default(cuid())
  name            String           @unique
  description     String?
  price           Float
  durationDays    Int
  discountPercent Float
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  memberships     UserMembership[]
}

model UserMembership {
  id        String         @id @default(cuid())
  userId    String
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  planId    String
  plan      MembershipPlan @relation(fields: [planId], references: [id])
  startDate DateTime
  endDate   DateTime
  isActive  Boolean        @default(true)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
}

model SubscriptionPlan {
  id               Int            @id @default(autoincrement())
  name             String
  slug             String         @unique
  shortDescription String? // Small text shown on cards
  itemsSummary     String? // Human-readable text list of items included
  itemsJson        Json? // Optional structured list for future use
  priceMonthly     Int // Price per month in BDT
  bannerImageUrl   String? // Banner/card image
  isFeatured       Boolean        @default(false)
  isActive         Boolean        @default(true)
  sortOrder        Int? // For ordering in UI
  subscriptions    Subscription[]
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}

model Subscription {
  id             Int              @id @default(autoincrement())
  userId         String
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  planId         Int
  plan           SubscriptionPlan @relation(fields: [planId], references: [id])
  pricePerPeriod Int
  status         String           @default("pending") // 'pending', 'active', 'paused', 'cancelled'
  paymentStatus  String           @default("unpaid") // 'unpaid', 'paid', 'refunded'
  paymentMethod  String           @default("cod") // 'cod', 'bkash', 'online'
  startDate      DateTime         @default(now())
  nextDelivery   DateTime
  address        String
  zoneId         String?
  zone           Zone?            @relation(fields: [zoneId], references: [id])
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
}

model Banner {
  id               String         @id @default(cuid())
  title            String
  subtitle         String?
  description      String?
  imageUrl         String // Legacy field, kept for backward compatibility
  imageDesktopUrl  String? // Desktop-specific image
  imageMobileUrl   String? // Mobile-specific image
  link             String? // Legacy field, kept for backward compatibility
  ctaLabel         String? // Call-to-action button label
  ctaUrl           String? // Call-to-action URL
  bgColor          String? // Background color
  textColor        String? // Text color
  location         BannerLocation @default(HOME_HERO) // Treated as locationCode
  order            Int            @default(0)
  isActive         Boolean        @default(true)
  startAt          DateTime? // Schedule start date/time
  endAt            DateTime? // Schedule end date/time
  visibilityDevice String         @default("all") // 'all' | 'desktop' | 'mobile'
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}

model HomeSection {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  filterType  String // 'category' | 'brand' | 'manual'
  categoryId  String?
  brandName   String?
  productIds  Json? // string[] of Product.id
  maxProducts Int       @default(10)
  bgColor     String?
  badgeText   String?
  sortOrder   Int       @default(0)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  category    Category? @relation(fields: [categoryId], references: [id])

  @@index([sortOrder])
  @@index([isActive, sortOrder])
}

model Page {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  content     String    @db.Text
  group       PageGroup @default(SUPPORT)
  sortOrder   Int       @default(0)
  isPublished Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([group, isPublished, sortOrder])
}

// Generic admin settings storage system
// No previous settings model existed in this codebase.
// This unified model stores all admin settings as JSON by key.
// Each key represents a settings section (e.g., "basic", "branding", "checkout", "facebook-pixel")
model Setting {
  id        String   @id @default(cuid())
  key       String   @unique // Settings section key (e.g., "basic", "branding", "checkout")
  value     Json     // Full settings object for that section
  updatedAt DateTime @updatedAt
}

// AI Product Import Wizard - Phase 1
// Stores import job metadata and tracks processing progress
model AiImportJob {
  id               String            @id @default(cuid())
  createdByAdminId String            // Admin user who created the import
  csvPath          String            // Supabase storage path to uploaded CSV
  status           AiImportJobStatus @default(PENDING)
  totalRows        Int?              // Total rows in CSV (set after parsing)
  processedRows    Int               @default(0) // Rows processed so far
  failedRows       Int               @default(0) // Rows that failed AI processing
  errorSummary     String?           // Summary of errors if any
  config           Json?             // Configuration: model name, batch size, etc.
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  // Phase 3: Image handling fields
  zipPath          String?           // Supabase storage path to uploaded images ZIP
  imageTotal       Int?              // Total number of images found in ZIP
  imageProcessed   Int               @default(0) // Number of images processed (watermarked, stored)
  imageStatus      AiImageJobStatus  @default(NONE) // Image processing status

  // Relations
  drafts AiProductDraft[]

  @@index([status])
  @@index([createdByAdminId])
}

// AI Product Import Wizard - Phase 1 & 2
// Stores individual product drafts with raw CSV data and AI suggestions
model AiProductDraft {
  id                 String               @id @default(cuid())
  importJobId        String               // FK to AiImportJob
  importJob          AiImportJob          @relation(fields: [importJobId], references: [id], onDelete: Cascade)
  rowIndex           Int                  // Original CSV row number (for reference)
  rawData            Json                 // Full original CSV row as JSON
  aiSuggestion       Json?                // AI-generated structured data (brand_name, strength, descriptions, etc.)
  aiConfidence       Float?               // Overall confidence score (0-1)
  status             AiProductDraftStatus @default(PENDING_REVIEW)
  publishedProductId String?              // FK to Product (set when approved and published)
  notes              String?              // Admin comments/notes
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt

  // Phase 2: Master table match IDs (set by AI or admin)
  genericMatchId      String?              // FK to Generic (matched generic)
  generic             Generic?             @relation(fields: [genericMatchId], references: [id])
  manufacturerMatchId String?              // FK to Manufacturer (matched manufacturer)
  manufacturer        Manufacturer?        @relation(fields: [manufacturerMatchId], references: [id])
  categoryMatchId     String?              // FK to Category (matched category)
  category            Category?            @relation(fields: [categoryMatchId], references: [id])
  subcategoryMatchId  String?              // FK to Category (matched subcategory)
  subcategory         Category?            @relation("SubcategoryDrafts", fields: [subcategoryMatchId], references: [id])

  // Phase 2: Field-level confidence scores (0-1)
  genericConfidence      Float?            // Confidence for generic match
  manufacturerConfidence Float?            // Confidence for manufacturer match
  categoryConfidence     Float?            // Confidence for category match

  // Phase 2: QC verification flags (admin must verify before approval)
  genericVerified      Boolean @default(false)
  manufacturerVerified Boolean @default(false)
  categoryVerified     Boolean @default(false)

  // Phase 2: Suggested new values (if no match found)
  newGenericSuggested      String?         // AI suggested new generic name
  newManufacturerSuggested String?         // AI suggested new manufacturer name

  // Phase 3: Image handling fields
  imageRawFilename     String?              // Filename inside ZIP that was matched (e.g., "Sergel_Capsule_20mg.webp")
  imageMatchConfidence Float?               // Confidence score for image match (0-1)
  imageStatus          AiImageDraftStatus   @default(UNMATCHED) // Image processing status
  imageUrl             String?              // Final URL/path of processed watermarked image

  @@index([importJobId])
  @@index([status])
  @@index([importJobId, status])
  @@index([genericMatchId])
  @@index([manufacturerMatchId])
  @@index([categoryMatchId])
  @@index([imageStatus])
}

// Cart Page Settings (singleton - only one row)
model CartPageSettings {
  id                       String   @id @default(cuid())
  freeDeliveryThreshold    Int      @default(499)
  freeDeliveryTextBn       String   @default("‡¶Ü‡¶∞ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡ß≥{remaining} ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶£‡ßç‡¶Ø ‡¶ï‡¶ø‡¶®‡¶≤‡ßá ‡¶´‡ßç‡¶∞‡¶ø ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶®!")
  freeDeliverySuccessTextBn String  @default("‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶´‡ßç‡¶∞‡¶ø ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶® üéâ")
  promoLabelBn             String   @default("‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶ï‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®")
  promoApplyTextBn         String   @default("[Apply]")
  deliveryInfoTextBn       String   @default("‡¶Ü‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø: ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤")
  totalMrpLabelBn          String   @default("‡¶Æ‡ßã‡¶ü ‡¶è‡¶Æ.‡¶Ü‡¶∞.‡¶™‡¶ø:")
  savingsLabelBn           String   @default("‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶æ‡¶∂‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡¶õ‡ßá‡¶®:")
  grandTotalLabelBn        String   @default("‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü:")
  checkoutButtonTextBn     String   @default("‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶ö‡ßá‡¶ï‡¶Ü‡¶â‡¶ü")
  suggestionTitleBn        String   @default("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶ú‡ßá‡¶∂‡¶®")
  emptyCartTextBn          String   @default("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø")
  emptyCartSubtextBn       String   @default("‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶∂‡¶™‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá")
  startShoppingTextBn      String   @default("‡¶∂‡¶™‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®")
  cartTitleBn              String   @default("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü")
  updatedAt                DateTime @updatedAt
}

// Cart Suggestions (cross-sell products shown in cart)
model CartSuggestion {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive, sortOrder])
}

// Master Tables for AI Import Wizard - Phase 2

// Generic (active ingredient) master table
model Generic {
  id        String   @id @default(cuid())
  name      String   @unique // Primary generic name (e.g., "Esomeprazole")
  synonyms  Json?    // Array of alternative names/spellings (e.g., ["Esomeprazol", "Esomeprazole Magnesium"])
  slug      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  drafts AiProductDraft[]

  @@index([name])
}

// Manufacturer master table
model Manufacturer {
  id                    String   @id @default(cuid())
  name                  String   @unique // Primary manufacturer name (e.g., "Square Pharmaceuticals Ltd.")
  aliasList             Json?    // Array of alternative names (e.g., ["Square", "Square Pharma"])
  slug                  String   @unique
  logoUrl               String?  // Manufacturer logo image URL
  websiteUrl            String?  // Manufacturer website URL
  description           String?  // Manufacturer description
  phoneNumber           String?  // Contact phone number (e.g., "+8801XXXXXXXXX")
  requiresQcVerification Boolean @default(true) // Whether products from this manufacturer need extra QC
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Relations
  drafts   AiProductDraft[]
  products Product[]

  @@index([name])
}

// Wishlist - user-specific product favorites
model WishlistItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, productId])
  @@index([userId])
}
